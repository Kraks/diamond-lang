--------------------
Γ | ϕ ⊢ () => Unit^∅


l ∈ ℕ
------------------
Γ | ϕ ⊢ l => Num^∅


l ∈ 𝔹
-------------------
Γ | ϕ ⊢ l => Bool^∅


T^q := Γ(x)
x ∈ ϕ
-----------------
Γ | ϕ ⊢ x => T^x


op ∈ { ~ }
Γ | ϕ ⊢ e => Q
Γ ⊢ Q == Bool^∅
-----------------------
Γ | ϕ ⊢ op e => Bool^∅


op ∈ { + - * / }
Γ | ϕ ⊢ e1 => Q1
Γ | ϕ ⊢ e2 => Q2
Γ ⊢ Q1 == Num^∅
Γ ⊢ Q2 == Num^∅
--------------------------
Γ | ϕ ⊢ e1 op e2 => Num^∅


op ∈ { && || }
Γ | ϕ ⊢ e1 => Q1
Γ | ϕ ⊢ e2 => Q2
Γ ⊢ Q1 == Bool^∅
Γ ⊢ Q2 == Bool^∅
---------------------------
Γ | ϕ ⊢ e1 op e2 => Bool^∅


op ∈ { == }
Γ | ϕ ⊢ e1 => Q1
Γ | ϕ ⊢ e2 => Q2
Γ ⊢ Q1 == Num^∅
Γ ⊢ Q2 == Num^∅
---------------------------
Γ | ϕ ⊢ e1 op e2 => Bool^∅


F := f(x: Q1) -> Q2
fv(F) ⊆ Γ
q := fv(t) \ { f x }
Γ, x: Q1, f: F^q | q,x,f ⊢ t => Q3
Γ, x: Q1, f: F^q ⊢ Q3 <: Q2
--------------------------------
Γ | ϕ ⊢ λf(x: Q1): Q2. t => F^q


fv(Q1) ⊆ Γ
q := fv(t) \ { x }
Γ, x: Q1 | q,x ⊢ t => Q2
-------------------------------------------
Γ | ϕ ⊢ λf(x: Q1). t => (f(x: Q1) -> Q2)^q


Γ | ϕ ⊢ e1 => (∀f(T^q <: Q1). Q2)^qf
Γ | ϕ ⊢ e2 => Q3
Γ | ϕ ⊢ e1[Q3](e2) => Q4
-------------------------
Γ | ϕ ⊢ e1(e2) => Q4


Γ | ϕ ⊢ e1 => (∀f(T^q <: Q1). Q2)^qf
Γ | ϕ ⊢ e2 => Q3
Γ | ϕ ⊢ e1[Q3]⧫(e2) => Q4
-------------------------
Γ | ϕ ⊢ e1⧫(e2) => Q4


Γ | ϕ ⊢ e1 => (∀f(T^q <: Q1). Q2)^qf
Γ | ϕ ⊢ e2 => Q3
Γ | ϕ ⊢ e1[Q3]◊(e2) => Q4
-------------------------
Γ | ϕ ⊢ e1◊(e2) => Q4


Γ | ϕ ⊢ e1 => (f(x: T1^q1) -> Q2)^qf
⧫ ∈ q1
Γ | ϕ ⊢ e1⧫(e2) => Q3
----------------------
Γ | ϕ ⊢ e1(e2) => Q3


Γ | ϕ ⊢ e1 => (f(x: T1^q1) -> Q2)^qf
⧫ ∉ q1
Γ | ϕ ⊢ e1◊(e2) => Q3
----------------------
Γ | ϕ ⊢ e1(e2) => Q3


Γ | ϕ ⊢ e1 => (f(x: T1^q1) -> T2^q2)^qf
q2 ⊆ Γ ∪ { ⧫ f x }
Γ | ϕ ⊢ e2 => T3^q3
⧫ ∈ q3 ⇒ x ∉ fv(T2)
⧫ ∈ qf ⇒ f ∉ fv(T2)
Γ ⊢ T3 <: T1
Γ ⊢ q3* ⧫∩ qf* <: q1*
------------------------------------
Γ | ϕ ⊢ e1⧫(e2) => T2^q2[q3/x][qf/f]


Γ | ϕ ⊢ e1 => (f(x: T1^q1) -> T2^q2)^qf
q2 ⊆ Γ ∪ { ⧫ f x }
Γ | ϕ ⊢ e2 => T3^q3
⧫ ∉ q3
Γ ⊢ T3^q3 <: T1^q1
------------------------------------
Γ | ϕ ⊢ e1⧫(e2) => T2^q2[q3/x][qf/f]