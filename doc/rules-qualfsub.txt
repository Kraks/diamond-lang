-------------------- T-Unit
Γ | ϕ ⊢ () => Unit^∅


l ∈ ℕ
------------------ T-Num
Γ | ϕ ⊢ l => Num^∅


l ∈ 𝔹
------------------- T-Bool
Γ | ϕ ⊢ l => Bool^∅


T^q := Γ(x)
x ∈ ϕ
----------------- T-Var
Γ | ϕ ⊢ x => T^x


op ∈ { ~ }
Γ | ϕ ⊢ e => Q
Γ ⊢ Q == Bool^∅
----------------------- T-UnOp-Bool
Γ | ϕ ⊢ op e => Bool^∅


op ∈ { + - * / }
Γ | ϕ ⊢ e1 => Q1
Γ | ϕ ⊢ e2 => Q2
Γ ⊢ Q1 == Num^∅
Γ ⊢ Q2 == Num^∅
-------------------------- T-BinOp-Num
Γ | ϕ ⊢ e1 op e2 => Num^∅


op ∈ { && || }
Γ | ϕ ⊢ e1 => Q1
Γ | ϕ ⊢ e2 => Q2
Γ ⊢ Q1 == Bool^∅
Γ ⊢ Q2 == Bool^∅
--------------------------- T-BinOp-Bool
Γ | ϕ ⊢ e1 op e2 => Bool^∅


op ∈ { == }
Γ | ϕ ⊢ e1 => Q1
Γ | ϕ ⊢ e2 => Q2
Γ ⊢ Q1 == Num^∅
Γ ⊢ Q2 == Num^∅
--------------------------- T-BinOp-Cmp
Γ | ϕ ⊢ e1 op e2 => Bool^∅


F := f(x: Q1) -> Q2
fv(F) ⊆ Γ
q := fv(t) \ { f x }
Γ, x: Q1, f: F^q | q,x,f ⊢ t => Q3
Γ, x: Q1, f: F^q ⊢ Q3 <: Q2
-------------------------------- T-Abs-Full
Γ | ϕ ⊢ λf(x: Q1): Q2. t => F^q


fv(Q1) ⊆ Γ
q := fv(t) \ { x }
Γ, x: Q1 | q,x ⊢ t => Q2
------------------------------------------- T-Abs-Partial
Γ | ϕ ⊢ λf(x: Q1). t => (f(x: Q1) -> Q2)^q


Γ | ϕ ⊢ e1 => (∀f(T^q <: Q1). Q2)^qf
Γ | ϕ ⊢ e2 => Q3
Γ | ϕ ⊢ e1[Q3](e2) => Q4
------------------------- T-App-TyApp
Γ | ϕ ⊢ e1(e2) => Q4


Γ | ϕ ⊢ e1 => (∀f(T^q <: Q1). Q2)^qf
Γ | ϕ ⊢ e2 => Q3
Γ | ϕ ⊢ e1[Q3]⧫(e2) => Q4
------------------------- T-App⧫-TyApp
Γ | ϕ ⊢ e1⧫(e2) => Q4


Γ | ϕ ⊢ e1 => (∀f(T^q <: Q1). Q2)^qf
Γ | ϕ ⊢ e2 => Q3
Γ | ϕ ⊢ e1[Q3]◊(e2) => Q4
------------------------- T-App◊-TyApp
Γ | ϕ ⊢ e1◊(e2) => Q4


Γ | ϕ ⊢ e1 => (f(x: T1^q1) -> Q2)^qf
⧫ ∈ q1
Γ | ϕ ⊢ e1⧫(e2) => Q3
---------------------- T-App-App⧫
Γ | ϕ ⊢ e1(e2) => Q3


Γ | ϕ ⊢ e1 => (f(x: T1^q1) -> Q2)^qf
⧫ ∉ q1
Γ | ϕ ⊢ e1◊(e2) => Q3
---------------------- T-App-App◊
Γ | ϕ ⊢ e1(e2) => Q3


Γ | ϕ ⊢ e1 => (f(x: T1^q1) -> T2^q2)^qf
q2 ⊆ Γ ∪ { ⧫ f x }
Γ | ϕ ⊢ e2 => T3^q3
⧫ ∈ q3 ⇒ x ∉ fv(T2)
⧫ ∈ qf ⇒ f ∉ fv(T2)
Γ ⊢ T3 <: T1
Γ ⊢ q3* ⧫∩ qf* <: q1*
------------------------------------- T-App⧫
Γ | ϕ ⊢ e1⧫(e2) => T2^q2 [q3/x, qf/f]


Γ | ϕ ⊢ e1 => (f(x: T1^q1) -> T2^q2)^qf
q2 ⊆ Γ ∪ { ⧫ f x }
Γ | ϕ ⊢ e2 => T3^q3
⧫ ∉ q3
Γ ⊢ T3^q3 <: T1^q1
------------------------------------- T-App◊
Γ | ϕ ⊢ e1◊(e2) => T2^q2 [q3/x, qf/f]


fv(Q1) ⊆ Γ
Γ | ϕ ⊢ e1 => Q2
Γ ⊢ Q2 <: Q1
Γ, x: Q1 | ϕ,x ⊢ e2 => Q3
------------------------------------ T-GLet-As
Γ | ϕ ⊢ glet x: Q1 = e1 in e2 => Q3


Γ | ϕ ⊢ e1 => Q1
Γ, x: Q1 | ϕ,x ⊢ e2 => Q2
------------------------------- T-GLet-None
Γ | ϕ ⊢ glet x = e1 in e2 => Q2


fv(T1^q1) ⊆ Γ
Γ | ϕ ⊢ e1 => Q2
Γ ⊢ Q2 <: T1^q1
Γ, x: T1^q1 | ϕ,x ⊢ e2 => T3^q3
⧫ ∈ q1 ⇒ x ∉ fv(T3)
----------------------------------------------- T-Let-As
Γ | ϕ ⊢ let x: T1^q1 = e1 in e2 => T3^q3 [q1/x]


Γ | ϕ ⊢ e1 => T1^q1
Γ, x: T1^q1 | ϕ,x ⊢ e2 => T2^q2
⧫ ∈ q1 ⇒ x ∉ fv(T2)
--------------------------------------- T-Let-None
Γ | ϕ ⊢ let x = e1 in e2 => T2^q2 [q/x]


Γ | ϕ ⊢ e1 => T1^q1
Γ, x: T1^q1 | ϕ,x ⊢ λf(y: Q2). t => (f(y: Q2) -> T3^q3)^qf
⧫ ∈ q1
x ∈ fv(T3^q3)
Γ | ϕ ⊢ let x = e1 in λf(y: Q2): T3^f. t => Q4
----------------------------------------------- T-Let-Escape
Γ | ϕ ⊢ let x = e1 in λf(y: Q2). t => Q4