------------------------------------------------------------------------- T-Unit
Î“ | Ï• âŠ¢ () => Unit^âˆ…


l âˆˆ â„•
-------------------------------------------------------------------------- T-Num
Î“ | Ï• âŠ¢ l => Num^âˆ…


l âˆˆ ð”¹
------------------------------------------------------------------------- T-Bool
Î“ | Ï• âŠ¢ l => Bool^âˆ…


T^q := Î“(x)
x âˆˆ Ï•
-------------------------------------------------------------------------- T-Var
Î“ | Ï• âŠ¢ x => T^x


op âˆˆ { ~ }
Î“ | Ï• âŠ¢ e => Q
Î“ âŠ¢ Q == Bool^âˆ…
-------------------------------------------------------------------- T-UnOp-Bool
Î“ | Ï• âŠ¢ op e => Bool^âˆ…


op âˆˆ { + - * / }
Î“ | Ï• âŠ¢ e1 => Q1
Î“ | Ï• âŠ¢ e2 => Q2
Î“ âŠ¢ Q1 == Num^âˆ…
Î“ âŠ¢ Q2 == Num^âˆ…
-------------------------------------------------------------------- T-BinOp-Num
Î“ | Ï• âŠ¢ e1 op e2 => Num^âˆ…


op âˆˆ { && || }
Î“ | Ï• âŠ¢ e1 => Q1
Î“ | Ï• âŠ¢ e2 => Q2
Î“ âŠ¢ Q1 == Bool^âˆ…
Î“ âŠ¢ Q2 == Bool^âˆ…
------------------------------------------------------------------- T-BinOp-Bool
Î“ | Ï• âŠ¢ e1 op e2 => Bool^âˆ…


op âˆˆ { == }
Î“ | Ï• âŠ¢ e1 => Q1
Î“ | Ï• âŠ¢ e2 => Q2
Î“ âŠ¢ Q1 == Num^âˆ…
Î“ âŠ¢ Q2 == Num^âˆ…
-------------------------------------------------------------------- T-BinOp-Cmp
Î“ | Ï• âŠ¢ e1 op e2 => Bool^âˆ…


F := f(x: Q1) -> Q2
fv(F) âŠ† Î“
q := fv(t) \ { f x }
Î“, x: Q1, f: F^q | q,x,f âŠ¢ t => Q3
Î“, x: Q1, f: F^q âŠ¢ Q3 <: Q2
--------------------------------------------------------------------- T-Abs-Full
Î“ | Ï• âŠ¢ Î»f(x: Q1): Q2. t => F^q


fv(Q1) âŠ† Î“
q := fv(t) \ { x }
Î“, x: Q1 | q,x âŠ¢ t => Q2
------------------------------------------------------------------ T-Abs-Partial
Î“ | Ï• âŠ¢ Î»f(x: Q1). t => (f(x: Q1) -> Q2)^q


Î“ | Ï• âŠ¢ e1 => (âˆ€f(T^q <: Q1). Q2)^qf
Î“ | Ï• âŠ¢ e2 => Q3
Î“ | Ï• âŠ¢ e1[Q3](e2) => Q4
-------------------------------------------------------------------- T-App-TyApp
Î“ | Ï• âŠ¢ e1(e2) => Q4


Î“ | Ï• âŠ¢ e1 => (âˆ€f(T^q <: Q1). Q2)^qf
Î“ | Ï• âŠ¢ e2 => Q3
Î“ | Ï• âŠ¢ e1[Q3]â§«(e2) => Q4
------------------------------------------------------------------- T-Appâ§«-TyApp
Î“ | Ï• âŠ¢ e1â§«(e2) => Q4


Î“ | Ï• âŠ¢ e1 => (âˆ€f(T^q <: Q1). Q2)^qf
Î“ | Ï• âŠ¢ e2 => Q3
Î“ | Ï• âŠ¢ e1[Q3]â—Š(e2) => Q4
------------------------------------------------------------------- T-Appâ—Š-TyApp
Î“ | Ï• âŠ¢ e1â—Š(e2) => Q4


Î“ | Ï• âŠ¢ e1 => (f(x: T1^q1) -> Q2)^qf
â§« âˆˆ q1
Î“ | Ï• âŠ¢ e1â§«(e2) => Q3
--------------------------------------------------------------------- T-App-Appâ§«
Î“ | Ï• âŠ¢ e1(e2) => Q3


Î“ | Ï• âŠ¢ e1 => (f(x: T1^q1) -> Q2)^qf
â§« âˆ‰ q1
Î“ | Ï• âŠ¢ e1â—Š(e2) => Q3
--------------------------------------------------------------------- T-App-Appâ—Š
Î“ | Ï• âŠ¢ e1(e2) => Q3


Î“ | Ï• âŠ¢ e1 => (f(x: T1^q1) -> T2^q2)^qf
q2 âŠ† Î“ âˆª { â§« f x }
Î“ | Ï• âŠ¢ e2 => T3^q3
â§« âˆˆ q3 â‡’ x âˆ‰ fv(T2)
â§« âˆˆ qf â‡’ f âˆ‰ fv(T2)
Î“ âŠ¢ T3 <: T1
Î“ âŠ¢ q3* â§«âˆ© qf* <: q1*
------------------------------------------------------------------------- T-Appâ§«
Î“ | Ï• âŠ¢ e1â§«(e2) => T2^q2 [q3/x, qf/f]


Î“ | Ï• âŠ¢ e1 => (f(x: T1^q1) -> T2^q2)^qf
q2 âŠ† Î“ âˆª { â§« f x }
Î“ | Ï• âŠ¢ e2 => T3^q3
â§« âˆ‰ q3
Î“ âŠ¢ T3^q3 <: T1^q1
------------------------------------------------------------------------- T-Appâ—Š
Î“ | Ï• âŠ¢ e1â—Š(e2) => T2^q2 [q3/x, qf/f]


fv(Q1) âŠ† Î“
Î“ | Ï• âŠ¢ e1 => Q2
Î“ âŠ¢ Q2 <: Q1
Î“, x: Q1 | Ï•,x âŠ¢ e2 => Q3
-------------------------------------------------------------------- T-GLet-Anno
Î“ | Ï• âŠ¢ glet x: Q1 = e1 in e2 => Q3


Î“ | Ï• âŠ¢ e1 => Q1
Î“, x: Q1 | Ï•,x âŠ¢ e2 => Q2
-------------------------------------------------------------------- T-GLet-None
Î“ | Ï• âŠ¢ glet x = e1 in e2 => Q2


fv(T1^q1) âŠ† Î“
Î“ | Ï• âŠ¢ e1 => Q2
Î“ âŠ¢ Q2 <: T1^q1
Î“, x: T1^q1 | Ï•,x âŠ¢ e2 => T3^q3
â§« âˆˆ q1 â‡’ x âˆ‰ fv(T3)
--------------------------------------------------------------------- T-Let-Anno
Î“ | Ï• âŠ¢ let x: T1^q1 = e1 in e2 => T3^q3 [q1/x]


Î“ | Ï• âŠ¢ e1 => T1^q1
Î“, x: T1^q1 | Ï•,x âŠ¢ e2 => T2^q2
â§« âˆˆ q1 â‡’ x âˆ‰ fv(T2)
--------------------------------------------------------------------- T-Let-None
Î“ | Ï• âŠ¢ let x = e1 in e2 => T2^q2 [q/x]


Î“ | Ï• âŠ¢ e1 => T1^q1
Î“, x: T1^q1 | Ï•,x âŠ¢ Î»f(y: Q2). t => (f(y: Q2) -> T3^q3)^qf
â§« âˆˆ q1
x âˆˆ fv(T3^q3)
Î“ | Ï• âŠ¢ let x = e1 in Î»f(y: Q2): T3^f. t => Q4
------------------------------------------------------------------- T-Let-Escape
Î“ | Ï• âŠ¢ let x = e1 in Î»f(y: Q2). t => Q4


Î“ | Ï• âŠ¢ e => T^q
â§« âˆ‰ q
-------------------------------------------------------------------------- T-Ref
Î“ | Ï• âŠ¢ ref e => Ref[T^q]^{â§«q}


Î“ | Ï• âŠ¢ e => T^q
Î“ âŠ¢ q == âˆ…
------------------------------------------------------------------ T-Ref-Untrack
Î“ | Ï• âŠ¢ ref e => Ref[T^âˆ…]^âˆ…


Î“ | Ï• âŠ¢ e1 => Ref[T1^q1]^p
Î“ | Ï• âŠ¢ e2 => T2^q2
â§« âˆ‰ q1 âˆª q2
Î“ âŠ¢ T1^q1 == T2^q2
----------------------------------------------------------------------- T-Assign
Î“ | Ï• âŠ¢ e1 := e2 => Unit


Î“ | Ï• âŠ¢ e => Ref[T^q]^p
â§« âˆ‰ q
------------------------------------------------------------------------ T-Deref
Î“ | Ï• âŠ¢ ! e => T^q


Î“ | Ï• âŠ¢ c => Q1
Î“ âŠ¢ Q1 == Bool^âˆ…
Î“ | Ï• âŠ¢ tb => Q2
Î“ | Ï• âŠ¢ fb => Q3
------------------------------------------------------------------------- T-Cond
Î“ | Ï• âŠ¢ if c then tb else fb => Q2 âŠ” Q3


T := âˆ€f(T^q <: Q1). Q2
p := fv(e) \ { f q }
Î“, T^q <: Q1, f: T^p | p,q,f âŠ¢ e => Q3
Î“, T^q <: Q1, f: T^p âŠ¢ Q3 <: Q2
------------------------------------------------------------------- T-TyAbs-Full
Î“ | Ï• âŠ¢ Î›f(T^q <: Q1): Q2. e => T^p


p := fv(e) \ { q }
Î“, T^q <: Q1 | p,q âŠ¢ e => Q2
---------------------------------------------------------------- T-TyAbs-Partial
Î“ | Ï• âŠ¢ Î›f(T^q <: Q1). e => (âˆ€f(T^q <: Q1). Q2)^p


fv(T^q) âŠ† Î“
Î“ | Ï• âŠ¢ e => Q1
Î“ âŠ¢ Q1 â‡‘ (âˆ€f(T1^q1 <: T2^q2). Q3)^qf
â§« âˆˆ q2
Î“ | Ï• âŠ¢ eâ§«[T^q] => Q4
----------------------------------------------------------------- T-TyApp-TyAppâ§«
Î“ | Ï• âŠ¢ e[T^q] => Q4


fv(T^q) âŠ† Î“
Î“ | Ï• âŠ¢ e => Q1
Î“ âŠ¢ Q1 â‡‘ (âˆ€f(T1^q1 <: T2^q2). Q3)^qf
â§« âˆ‰ q2
Î“ | Ï• âŠ¢ eâ—Š[T^q] => Q4
----------------------------------------------------------------- T-TyApp-TyAppâ—Š
Î“ | Ï• âŠ¢ e[T^q] => Q4


fv(T^q) âŠ† Î“
Î“ | Ï• âŠ¢ e => Q1
Î“ âŠ¢ Q1 â‡‘ (âˆ€f(T1^q1 <: T2^q2). T3^q3)^qf
q3 âŠ† Î“ âˆª { â§« f q1 }
q âŠ† â§«Î“
â§« âˆˆ q â‡’ q1 âˆ‰ T3
â§« âˆˆ qf â‡’ f âˆ‰ T3
Î“ âŠ¢ T <: T2
Î“ âŠ¢ q* â§«âˆ© qf* <: q2*
----------------------------------------------------------------------- T-TyAppâ§«
Î“ | Ï• âŠ¢ eâ§«[T^q] => T3^q3 [qf/f, T^q/T1^q1]


fv(T^q) âŠ† Î“
Î“ | Ï• âŠ¢ e => Q1
Î“ âŠ¢ Q1 â‡‘ (âˆ€f(T1^q1 <: T2^q2). T3^q3)^qf
q3 âŠ† Î“ âˆª { â§« f q1 }
q âŠ† â§«Î“
â§« âˆ‰ q
Î“ âŠ¢ T^q <: T2^q2
----------------------------------------------------------------------- T-TyAppâ—Š
Î“ | Ï• âŠ¢ eâ—Š[T^q] => T3^q3 [qf/f, T^q/T1^q1]