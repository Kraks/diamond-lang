Î“ | Ï• âŠ¢ e â‡’ T1
Î“ âŠ¢ T1 <: T2
-------------------------------------------------------------------------- T-Sub
Î“ | Ï• âŠ¢ e â‡ T2


------------------------------------------------------------------------- T-Unit
Î“ | Ï• âŠ¢ () â‡’ Unit^âˆ…


l âˆˆ â„•
-------------------------------------------------------------------------- T-Num
Î“ | Ï• âŠ¢ l â‡’ Num^âˆ…


l âˆˆ ð”¹
------------------------------------------------------------------------- T-Bool
Î“ | Ï• âŠ¢ l â‡’ Bool^âˆ…


T^q := Î“(x)
x âˆˆ Ï•
-------------------------------------------------------------------------- T-Var
Î“ | Ï• âŠ¢ x â‡’ T^x


op âˆˆ { ~ }
Î“ | Ï• âŠ¢ e â‡ Bool^âˆ…
-------------------------------------------------------------------- T-UnOp-Bool
Î“ | Ï• âŠ¢ op e â‡’ Bool^âˆ…


op âˆˆ { + - * / }
Î“ | Ï• âŠ¢ e1 â‡ Num^âˆ…
Î“ | Ï• âŠ¢ e2 â‡ Num^âˆ…
-------------------------------------------------------------------- T-BinOp-Num
Î“ | Ï• âŠ¢ e1 op e2 â‡’ Num^âˆ…


op âˆˆ { && || }
Î“ | Ï• âŠ¢ e1 â‡ Bool^âˆ…
Î“ | Ï• âŠ¢ e2 â‡ Bool^âˆ…
------------------------------------------------------------------- T-BinOp-Bool
Î“ | Ï• âŠ¢ e1 op e2 â‡’ Bool^âˆ…


op âˆˆ { == }
Î“ | Ï• âŠ¢ e1 â‡ Num^âˆ…
Î“ | Ï• âŠ¢ e2 â‡ Num^âˆ…
-------------------------------------------------------------------- T-BinOp-Cmp
Î“ | Ï• âŠ¢ e1 op e2 â‡’ Bool^âˆ…


F := f(x: Q1) -> Q2
fv(F) âŠ† Î“
q := fv(t) \ { f x }
Î“, x: Q1, f: F^q | q,x,f âŠ¢ t â‡ Q2
--------------------------------------------------------------------- T-Abs-Full
Î“ | Ï• âŠ¢ Î»f(x: Q1): Q2. t â‡’ F^q


fv(Q1) âŠ† Î“
q := fv(t) \ { x }
Î“, x: Q1 | q,x âŠ¢ t â‡’ Q2
------------------------------------------------------------------ T-Abs-Partial
Î“ | Ï• âŠ¢ Î»f(x: Q1). t â‡’ (f(x: Q1) -> Q2)^q


Î“ | Ï• âŠ¢ e1 â‡’â‡‘ (âˆ€f(T^q <: Q3). Q4)^qf
Î“ | Ï• âŠ¢ e2 â‡’ Q2
Î“ | Ï• âŠ¢ e1[Q2](e2) â‡’ Q5
-------------------------------------------------------------------- T-App-TyApp
Î“ | Ï• âŠ¢ e1(e2) â‡’ Q5


Î“ | Ï• âŠ¢ e1 â‡’â‡‘ (f(x: Q1) -> Q2)^qf
Î“ | Ï• âŠ¢ e2 â‡’ Q3
Î“ | Ï• âŠ¢ (f(x: Q1) -> Q2)^qf @ Q3 â‡’ Q4
-------------------------------------------------------------------------- T-App
Î“ | Ï• âŠ¢ e1(e2) â‡’ Q4


â§« âˆ‰ q3
Î“ âŠ¢ T3^q3 <: Q1
------------------------------------------------------------------------- T-Appâ—Š
Î“ | Ï• âŠ¢ (f(x: Q1) -> Q2)^qf @ T3^q3 â‡’ Q2 [q3/x, qf/f]


â§« âˆˆ q4
x âˆˆ qg
Î“ | Ï• âŠ¢ (f(x: Q1) -> ((g(y: Q2) -> Q3) [g/x])^qg)^qf @ T4^q4 â‡’ Q5
-------------------------------------------------------------------- T-Appâ§«-FunX
Î“ | Ï• âŠ¢ (f(x: Q1) -> (g(y: Q2) -> Q3)^qg)^qf @ T4^q4 â‡’ Q5


â§« âˆˆ qf
f âˆˆ qg
Î“ | Ï• âŠ¢ (f(x: Q1) -> ((g(y: Q2) -> Q3) [g/f])^qg)^qf @ T4^q4 â‡’ Q5
-------------------------------------------------------------------- T-Appâ§«-FunF
Î“ | Ï• âŠ¢ (f(x: Q1) -> (g(y: Q2) -> Q3)^qg)^qf @ T4^q4 â‡’ Q5


â§« âˆˆ q3 ==> x âˆ‰ fv(T2)
â§« âˆˆ qf ==> f âˆ‰ fv(T2)
Î“ âŠ¢ T3^(q3* â§«âˆ© qf*) <: T1^q1
------------------------------------------------------------------------- T-Appâ§«
Î“ | Ï• âŠ¢ (f(x: Q1) -> T2^q2)^qf @ T3^q3 â‡’ Q2 [q3/x, qf/f]


fv(Q1) âŠ† Î“
Î“ | Ï• âŠ¢ e1 â‡’ Q2
Î“ âŠ¢ Q2 <: Q1
Î“, x: Q1 | Ï•,x âŠ¢ e2 â‡’ Q3
-------------------------------------------------------------------- T-GLet-Anno
Î“ | Ï• âŠ¢ glet x: Q1 = e1 in e2 â‡’ Q3


Î“ | Ï• âŠ¢ e1 â‡’ Q1
Î“, x: Q1 | Ï•,x âŠ¢ e2 â‡’ Q2
-------------------------------------------------------------------- T-GLet-None
Î“ | Ï• âŠ¢ glet x = e1 in e2 â‡’ Q2


fv(T1^q1) âŠ† Î“
Î“ | Ï• âŠ¢ e1 â‡’ Q2
Î“ âŠ¢ Q2 <: T1^q1
Î“, x: T1^q1 | Ï•,x âŠ¢ e2 â‡’ T3^q3
â§« âˆˆ q1 ==> x âˆ‰ fv(T3)
--------------------------------------------------------------------- T-Let-Anno
Î“ | Ï• âŠ¢ let x: T1^q1 = e1 in e2 â‡’ T3^q3 [q1/x]


Î“ | Ï• âŠ¢ e1 â‡’ T1^q1
Î“, x: T1^q1 | Ï•,x âŠ¢ e2 â‡’ T2^q2
â§« âˆˆ q1 ==> x âˆ‰ fv(T2)
--------------------------------------------------------------------- T-Let-None
Î“ | Ï• âŠ¢ let x = e1 in e2 â‡’ T2^q2 [q/x]


Î“ | Ï• âŠ¢ e1 â‡’ T1^q1
Î“, x: T1^q1 | Ï•,x âŠ¢ Î»f(y: Q2). t â‡’ (f(y: Q2) -> T3^q3)^qf
â§« âˆˆ q1
x âˆˆ fv(T3^q3)
Î“ | Ï• âŠ¢ let x = e1 in Î»f(y: Q2): T3^f. t â‡’ Q4
------------------------------------------------------------------- T-Let-Escape
Î“ | Ï• âŠ¢ let x = e1 in Î»f(y: Q2). t â‡’ Q4


Î“ | Ï• âŠ¢ e â‡’ T^q
â§« âˆ‰ q
-------------------------------------------------------------------------- T-Ref
Î“ | Ï• âŠ¢ ref e â‡’ Ref[T^q]^{â§«q}


Î“ | Ï• âŠ¢ e â‡’ T^q
Î“ âŠ¢ q <: âˆ…
------------------------------------------------------------------ T-Ref-Untrack
Î“ | Ï• âŠ¢ ref e â‡’ Ref[T^âˆ…]^âˆ…


Î“ | Ï• âŠ¢ e1 â‡’ Ref[T1^q1]^p
Î“ | Ï• âŠ¢ e2 â‡’ T2^q2
â§« âˆ‰ q1 âˆª q2
Î“ âŠ¢ T2^q2 <: T1^q1
----------------------------------------------------------------------- T-Assign
Î“ | Ï• âŠ¢ e1 := e2 â‡’ Unit


Î“ | Ï• âŠ¢ e â‡’ Ref[T^q]^p
â§« âˆ‰ q
------------------------------------------------------------------------ T-Deref
Î“ | Ï• âŠ¢ ! e â‡’ T^q


Î“ | Ï• âŠ¢ c â‡’ Q1
Î“ âŠ¢ Q1 <: Bool^âˆ…
Î“ | Ï• âŠ¢ tb â‡’ Q2
Î“ | Ï• âŠ¢ fb â‡’ Q3
------------------------------------------------------------------------- T-Cond
Î“ | Ï• âŠ¢ if c then tb else fb â‡’ Q2 âŠ” Q3


T := âˆ€f(T^q <: Q1). Q2
p := fv(e) \ { f q }
Î“, T^q <: Q1, f: T^p | p,q,f âŠ¢ e â‡’ Q3
Î“, T^q <: Q1, f: T^p âŠ¢ Q3 <: Q2
------------------------------------------------------------------- T-TyAbs-Full
Î“ | Ï• âŠ¢ Î›f(T^q <: Q1): Q2. e â‡’ T^p


p := fv(e) \ { q }
Î“, T^q <: Q1 | p,q âŠ¢ e â‡’ Q2
---------------------------------------------------------------- T-TyAbs-Partial
Î“ | Ï• âŠ¢ Î›f(T^q <: Q1). e â‡’ (âˆ€f(T^q <: Q1). Q2)^p


fv(T^q) âŠ† Î“
Î“ | Ï• âŠ¢ e â‡’ Q1
Î“ âŠ¢ Q1 â‡‘ (âˆ€f(T1^q1 <: T2^q2). Q3)^qf
â§« âˆˆ q2
Î“ | Ï• âŠ¢ eâ§«[T^q] â‡’ Q4
----------------------------------------------------------------- T-TyApp-TyAppâ§«
Î“ | Ï• âŠ¢ e[T^q] â‡’ Q4


fv(T^q) âŠ† Î“
Î“ | Ï• âŠ¢ e â‡’ Q1
Î“ âŠ¢ Q1 â‡‘ (âˆ€f(T1^q1 <: T2^q2). Q3)^qf
â§« âˆ‰ q2
Î“ | Ï• âŠ¢ eâ—Š[T^q] â‡’ Q4
----------------------------------------------------------------- T-TyApp-TyAppâ—Š
Î“ | Ï• âŠ¢ e[T^q] â‡’ Q4


fv(T^q) âŠ† Î“
Î“ | Ï• âŠ¢ e â‡’ Q1
Î“ âŠ¢ Q1 â‡‘ (âˆ€f(T1^q1 <: T2^q2). T3^q3)^qf
q3 âŠ† Î“ âˆª { â§« f q1 }
q âŠ† â§«Î“
â§« âˆˆ q ==> q1 âˆ‰ T3
â§« âˆˆ qf ==> f âˆ‰ T3
Î“ âŠ¢ T <: T2
Î“ âŠ¢ q* â§«âˆ© qf* <: q2*
----------------------------------------------------------------------- T-TyAppâ§«
Î“ | Ï• âŠ¢ eâ§«[T^q] â‡’ T3^q3 [qf/f, T^q/T1^q1]


fv(T^q) âŠ† Î“
Î“ | Ï• âŠ¢ e â‡’ Q1
Î“ âŠ¢ Q1 â‡‘ (âˆ€f(T1^q1 <: T2^q2). T3^q3)^qf
q3 âŠ† Î“ âˆª { â§« f q1 }
q âŠ† â§«Î“
â§« âˆ‰ q
Î“ âŠ¢ T^q <: T2^q2
----------------------------------------------------------------------- T-TyAppâ—Š
Î“ | Ï• âŠ¢ eâ—Š[T^q] â‡’ T3^q3 [qf/f, T^q/T1^q1]